{# Set which global nav link to highlight #}
{% set globalNavSection = 'tasks' %}

{% extends "../layout.njk" %}

{% set pageName = "Pension prividor select" %}

{% set providers = data.realpensions.data.citizen.pensionAccounts[data.pensionCount] %}


{% block content %}
<div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">

        {% include '../partials/name/eric.njk' %}
        <p><a href="javascript:history.back()" class="govuk-back-link">Back</a></p>



        <form method="post">
        <div class="govuk-form-group">
          <fieldset class="govuk-fieldset">
            <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">
              <span class="govuk-caption-l">Workplace and private pensions</span>
              <h1 class="govuk-heading-l">
                Which payments from {{providers.pensionProviderPayeScheme.pensionProviderName1}} {{providers.pensionProviderPayeScheme.pensionProviderName2}} do you want to use
                {% if data['pensionSplit'] == 'more'%}
                  {% if data['pensionsUsedLength'] > 1 %}
                    for the next pension?
                                      {% else %}
                    for the first pension?
                  {% endif %}
                {% endif %}
              </h1>
            </legend>
            <p class="govuk-body">
              The payments you select will be used to calculate this person's income on 16 July 2025.
            </p>
            <div class="govuk-checkboxes" data-module="govuk-checkboxes">
              {% for payments in providers.pensionIncome %}

                {% if loop.index <= 6 %}
                  {% set currentRow = payments.paymentDate + " " + (payments.taxablePayInPeriod - payments.taxDeductedOrRefunded) + " " + payments.payFrequency %}
                  {%  if data.pensionsUsed %}
                    {% set testArray = data.pensionsUsed | string %}
                  {% endif %}

                    {% if data.pensionsUsed and currentRow in testArray %}

                    {% else %}
                      <div class="govuk-checkboxes__item">
                        <input class="govuk-checkboxes__input" id="pension{{loop.index0}}" name="pension" type="checkbox" value="{{payments.paymentDate}} {{(payments.taxablePayInPeriod - payments.taxDeductedOrRefunded)}} {{payments.payFrequency}}">
                        <label class="govuk-label govuk-checkboxes__label" for="pension{{loop.index0}}">
                          {{(payments.taxablePayInPeriod - payments.taxDeductedOrRefunded) | currency }} paid {{payments.payFrequency | paymentFrequency | lower}} on {{payments.paymentDate | govukDate }}
                        </label>
                      </div>
                    {% endif %}
                  {% endif %}

              {% endfor %}
            </div>
        </div>



          <button type="submit" class="govuk-button" data-module="govuk-button">
            Continue
          </button>
          {% if data.pensionSplitCount > 2 %}
          <a href="#" class="govuk-button govuk-button--secondary">Do not use any of these payments</a>
          {% endif %}
        </form>
    </div>
</div>
{% endblock %}
